<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>kronk</title>

<style>
/* ---------- BASE + PALETTE ---------- */
:root {
  --c-black:#1a1a1a; --c-white:#e1e1e1; --c-grey:#898989;
  --c-purple:#b462ff; --c-fuschia:#ff45b4; --c-blue:#18b6ff;
  --c-green:#1beb9e; --c-orange:#ff9528; --c-yellow:#dddd25;
  --line:2.5ch;
  --font:'IBM', monospace;
}
html,body{
  margin:0;
  background:var(--c-black);
  color:var(--c-white);
  height:100%;
  font-family:var(--font);
  line-height:var(--line);
}
body { font-size:3.97vw; }
@media (min-width: 768px) { body { font-size:2vw; } }
@media (min-width: 1024px) { body { font-size:1.11111111vw; } } 

/* ---------- HYDRA FULLSCREEN BACKGROUND ---------- */
#hydra-bg {
  position:fixed;
  top:0; left:0;
  width:100vw;
  height:100vh;
  z-index:0;
  overflow:hidden;
}
#hydra-canvas {
  width:100%; height:100%; display:block; background:black;
  pointer-events:none;
}

/* ---------- TOP-LEFT ICON + TRACK DISPLAY ---------- */
#top-left-icon {
  position: fixed;
  top: 2vw;
  left: 2vw;
  width: 15vw;
  height: auto;
  z-index: 5;
  cursor: pointer;
  user-select: none;
  font-size: 15vw;
  display: flex;
  flex-direction: column;
  align-items: center;
}
#current-track {
  margin-top: 0.3em;
  font-size: 1.2em;
  color: var(--c-green);
  text-align: center;
  max-width: 20vw;
  word-break: break-word;
}

/* ---------- LINKS PANEL ---------- */
#links-panel {
  position:fixed;
  top:0;
  right:0;
  width:25vw !important;
  max-width:25vw !important;
  height:100vh;
  overflow-y:scroll;
  background:rgba(26,26,26,0.85);
  padding:var(--line);
  z-index:2;
  scrollbar-width:none;
  font-size:1em;
  line-height:1.3em;
  white-space:normal !important;
  word-break:break-word;
}
#links-panel::-webkit-scrollbar{display:none;}

/* ---------- MOBILE WRAPPER ---------- */
@media (max-width: 768px) {
  #mobile-wrapper { display: flex; flex-direction: column; }
  #links-panel {
    width: 100% !important;
    max-width: 100% !important;
    height: auto !important;
    padding: calc(var(--line)/2) !important;
    background: rgba(26,26,26,0.9) !important;
    overflow: visible !important;
  }
}
</style>
</head>
<body>

<!-- ---------- HYDRA BACKGROUND ---------- -->
<div id="hydra-bg">
  <canvas id="hydra-canvas"></canvas>
</div>

<!-- ---------- TOP-LEFT ICON ---------- -->
<div id="top-left-icon">ðŸ”‡
  <div id="current-track"></div>
</div>

<!-- ---------- MOBILE WRAPPER FOR LINKS ---------- -->
<div id="mobile-wrapper">
  <aside id="links-panel">
    <div class="green x-multi-column">
      <a href="https://soundbreakingsky.bandcamp.com/album/ecstatic-edits-7" target="_blank">Ecstatic Edits #7</a><br>
      <a href="https://soundbreakingsky.bandcamp.com/album/ecstatic-edits-6" target="_blank">Ecstatic Edits #6</a><br>
      <a href="https://soundbreakingsky.bandcamp.com/album/ecstatic-edits-5" target="_blank">Ecstatic Edits #5</a><br>
      <a href="https://soundbreakingsky.bandcamp.com/album/ecstatic-edits-4" target="_blank">Ecstatic Edits #4</a><br>
      <a href="https://soundbreakingsky.bandcamp.com/album/ecstatic-edits-3" target="_blank">Ecstatic Edits #3</a><br>
      <a href="https://soundbreakingsky.bandcamp.com/album/ecstatic-edits-2" target="_blank">Ecstatic Edits #2</a><br>
    </div>
  </aside>
</div>

<!-- ---------- AUDIO ---------- -->
<audio id="audio-player"></audio>

<!-- ---------- SCRIPTS ---------- -->
<script src="https://unpkg.com/hydra-synth"></script>
<script>
window.addEventListener('load', () => {
  const canvas = document.getElementById("hydra-canvas");
  const dpr = window.devicePixelRatio || 1;
  canvas.width = innerWidth * dpr;
  canvas.height = innerHeight * dpr;

  const hydra = new Hydra({ canvas, detectAudio:false, makeGlobal:true });

  osc(10,0.9,300)
    .color(0.9,0.7,0.8)
    .diff(osc(45,0.3,100).color(0.9,0.9,0.9).rotate(0.18).pixelate(12).kaleid())
    .scrollX(10)
    .colorama()
    .luma()
    .repeatX(4)
    .repeatY(4)
    .modulate(osc(1,-0.9,300))
    .scale(2)
    .out();

  addEventListener('resize',()=>{
    canvas.width = innerWidth * dpr;
    canvas.height = innerHeight * dpr;
    if(hydra.resize) hydra.resize();
  });
});
</script>

<script>
// ---------- CONFIG ----------
const mp3Folder = "mp3/";
const mp3Files = [
  { file: "magnetize - hardcopy.mp3", link: "https://open.spotify.com/album/57ZDxDAMO5jVi7f0OTLYxA" },
  { file: "nwyvre - exotnotics.mp3", link: "https://fortevilfruit.bandcamp.com/album/manifes" },
  { file: "nwyvre - harmonic4.mp3", link: "https://nwyvre.bandcamp.com/album/harmonic" }
  // add other files as needed
];

// ---------- ELEMENTS ----------
const audio = document.getElementById("audio-player");
const iconDiv = document.getElementById("top-left-icon");
const currentTrackDiv = document.getElementById("current-track");

// Strip .mp3
const stripExtension = filename => filename.replace(/\.[^/.]+$/, "");

// ---------- SHUFFLE-BAG ----------
let shuffleBag = [];
function refillShuffleBag() { shuffleBag = mp3Files.slice(); fisherYatesShuffle(shuffleBag); }
function fisherYatesShuffle(array) { for (let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}}
function getNextRandomMP3() { if(shuffleBag.length===0) refillShuffleBag(); return shuffleBag.pop(); }

// ---------- PLAYBACK ----------
function playRandomMP3() {
  const track = getNextRandomMP3();
  const title = stripExtension(track.file);
  audio.src = mp3Folder + track.file;
  audio.play().catch(e=>console.log("Playback blocked:",e));
  currentTrackDiv.innerHTML = `<a href="${track.link}" target="_blank" style="color:var(--c-green); text-decoration:none;">${title}</a>`;
}

audio.addEventListener("ended", ()=>playRandomMP3());

// ---------- ICON CLICK ----------
let soundStarted = false;
iconDiv.addEventListener("click", ()=>{
  if(!soundStarted){
    soundStarted = true;
    iconDiv.firstChild.textContent = "ðŸŽ²";
  }
  playRandomMP3();
  randomizeHydra();
});

// ---------- HYDRA RANDOMIZATION ----------
function randomizeHydra(){
  const freq1 = 5 + Math.random()*40;
  const freq2 = 20 + Math.random()*80;
  const rot = Math.random()*3.14;
  const pix = 5 + Math.random()*30;

  osc(freq1,0.9,300)
    .color(Math.random(),Math.random(),Math.random())
    .diff(osc(freq2,0.3,100).color(Math.random(),Math.random(),Math.random()).rotate(rot).pixelate(pix).kaleid())
    .scrollX(Math.random()*20-10)
    .colorama()
    .luma()
    .repeatX(2+Math.floor(Math.random()*4))
    .repeatY(2+Math.floor(Math.random()*4))
    .modulate(osc(1,Math.random()*-2,300))
    .scale(1+Math.random()*2)
    .out();
}
</script>
</body>
</html>
